setwd("C:/Users/Ettore/Prog_domma_2")
library(readxl)
Serie_Storiche_Mensili_ISTAT <- read_excel("Esercizio 2/1/Serie Storiche Mensili _ ISTAT.xlsx")
View(Serie_Storiche_Mensili_ISTAT)
gc()
library(readxl)
Serie_Storiche_Mensili_ISTAT <- read_excel("Esercizio 2/1/Serie Storiche Mensili _ ISTAT.xlsx")
View(Serie_Storiche_Mensili_ISTAT)
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
(dplyr)
library(serie_Storiche)
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
# Lettura dei dati
dati_spesa <- read.table("Esercizio 2/2/1_spesa.txt", header = TRUE, sep = "\t")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/eser2.r")
source("C:/Users/Ettore/Prog_domma_2/analisi_semplice.R")
source("C:/Users/Ettore/Prog_domma_2/analisi_serie_storiche.R")
source("C:/Users/Ettore/Prog_domma_2/analisi_serie_storiche.R")
source("C:/Users/Ettore/Prog_domma_2/analisi_serie_storiche.R")
# Plot semplice
plot(x, y,
type = "l",  # 'l' per line
main = "Serie Storica ISTAT",
xlab = "Tempo",
ylab = "Valore",
col = "blue")
source("C:/Users/Ettore/Prog_domma_2/analisi_serie_storiche.R")
source("C:/Users/Ettore/Prog_domma_2/analisi_serie_storiche.R")
source("C:/Users/Ettore/Prog_domma_2/analisi_serie_storiche.R")
source("C:/Users/Ettore/Prog_domma_2/analisi_serie_storiche.R")
library(readxl)  # Carica la libreria per leggere file Excel (.xlsx)
# Imposta il percorso del file Excel
file_path <- "Esercizio 2/1/Serie Storiche Mensili _ ISTAT.xlsx"
# Legge i dati dal file Excel e li salva nella variabile dati_istat
dati_istat <- read_excel(file_path)
# Prende solo le righe che contengono i dati (dalla riga 8 in poi) e le salva in dati_valori
dati_valori <- dati_istat[8:nrow(dati_istat), ]
# Estrae la colonna delle date (seconda colonna) come caratteri
data <- as.character(dati_valori[[2]])
# Estrae la colonna degli indici di volumi di importazione (sesta colonna) e la trasforma in numerico
import_volumi <- as.numeric(dati_valori[[6]])
# Isola solo le righe dove sia la data che i volumi sono definiti (nessun NA)
validi <- !(is.na(data) | is.na(import_volumi))
data <- data[validi]
import_volumi <- import_volumi[validi]
# Converte la data nel formato Date di R: aggiunge "-01" per rappresentare il primo giorno del mese
data <- as.Date(paste0(data, "-01"), format="%Y-%m-%d")
# Crea il grafico a linee tra le date (asse x) e l'indice dei volumi (asse y)
plot(data, import_volumi, type = "l",
main = "Importazioni - Indici dei volumi (ISTAT)",
xlab = "Data", ylab = "Indice dei volumi importazioni",
col = "blue")
# Aggiunge i punti rossi ai valori della serie
points(data, import_volumi, pch = 16, col = "red", cex = 0.7)
# Aggiunge una griglia per facilitare la lettura sul grafico
grid()
# Calcola la media mobile sui volumi di importazione su una finestra di 12 mesi
media_mobile <- stats::filter(import_volumi, rep(1/12, 12), sides = 2)
# Aggiunge la linea della media mobile al grafico, colorata di rosso scuro e più spessa
lines(data, media_mobile, col = "darkred", lwd = 2)
source("C:/Users/Ettore/Prog_domma_2/analisi_serie_storiche.R")
source("C:/Users/Ettore/Prog_domma_2/analisi_serie_storiche.R")
source("C:/Users/Ettore/Prog_domma_2/analisi_serie_storiche.R")
# Rimuovo eventuali NA residui
df_series <- df_series[!is.na(df_series$Valore) & !is.na(df_series$Date), ]
source("C:/Users/Ettore/Prog_domma_2/analisi_serie_storiche.R")
source("C:/Users/Ettore/Prog_domma_2/analisi_serie_storiche.R")
library(readxl)  # Carica la libreria per leggere file Excel (.xlsx)
library(ggplot2) # Per il plot stagionale (boxplot mensile)
# Imposta il percorso del file Excel
file_path <- "Esercizio 2/1/Serie Storiche Mensili _ ISTAT.xlsx"
# Legge i dati dal file Excel e li salva nella variabile dati_istat
dati_istat <- read_excel(file_path)
# Prende solo le righe che contengono i dati (dalla riga 8 in poi) e le salva in dati_valori
dati_valori <- dati_istat[8:nrow(dati_istat), ]
# Estrae la colonna delle date (seconda colonna) come caratteri
data <- as.character(dati_valori[[2]])
# Estrae la colonna degli indici di volumi di importazione (sesta colonna) e la trasforma in numerico
import_volumi <- as.numeric(dati_valori[[6]])
# Isola solo le righe dove sia la data che i volumi sono definiti (nessun NA)
validi <- !(is.na(data) | is.na(import_volumi))
data <- data[validi]
import_volumi <- import_volumi[validi]
# Converte la data nel formato Date di R: aggiunge "-01" per rappresentare il primo giorno del mese
data <- as.Date(paste0(data, "-01"), format="%Y-%m-%d")
# Crea il grafico a linee tra le date (asse x) e l'indice dei volumi (asse y)
plot(data, import_volumi, type = "l",
main = "Importazioni - Indici dei volumi (ISTAT)",
xlab = "Data", ylab = "Indice dei volumi importazioni",
col = "blue")
# Aggiunge i punti rossi ai valori della serie
points(data, import_volumi, pch = 16, col = "red", cex = 0.7)
# Aggiunge una griglia per facilitare la lettura sul grafico
grid()
# Calcola la media mobile sui volumi di importazione su una finestra di 12 mesi
media_mobile <- stats::filter(import_volumi, rep(1/12, 12), sides = 2)
# Aggiunge la linea della media mobile al grafico, colorata di rosso scuro e più spessa
lines(data, media_mobile, col = "darkred", lwd = 2)
# --- Plot stagionalità: boxplot mensile ---
# Costruisco un dataframe pulito con Date e Valore
df_series <- data.frame(Date = data, Valore = import_volumi)
# Mese come fattore con etichette in ordine corretto
df_series$Mese <- factor(format(df_series$Date, "%m"),
levels = sprintf("%02d", 1:12),
labels = month.abb)
# Rimuovo eventuali NA residui
df_series <- df_series[!is.na(df_series$Valore) & !is.na(df_series$Date), ]
# --- ALTERNATIVE PER LA STAGIONALITÀ (sostituiscono il boxplot) ---
# Preparazione colonne Anno e Mese numerico
df_series$Anno <- format(df_series$Date, "%Y")
df_series$Mese_num <- as.integer(format(df_series$Date, "%m"))
# 1) Heatmap anno x mese (media dei valori) - utile per individuare pattern e anomalie
heatmap_df <- df_series %>%
group_by(Anno, Mese_num) %>%
summarise(Valore = mean(Valore, na.rm = TRUE)) %>%
ungroup()
plot_heatmap <- ggplot(heatmap_df, aes(x = Mese_num, y = Anno, fill = Valore)) +
geom_tile(color = "white") +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
scale_fill_gradient(low = "white", high = "steelblue", na.value = "grey90") +
labs(title = "Heatmap: Valori per Anno e Mese",
x = "Mese",
y = "Anno",
fill = "Valore") +
theme_minimal()
print(plot_heatmap)
ggsave(filename = "stagionalita_heatmap.png", plot = plot_heatmap, width = 10, height = 8)
# 2) Seasonal subseries: una linea per ogni anno (mesi sull'asse x)
plot_subseries <- ggplot(df_series, aes(x = Mese_num, y = Valore, group = Anno, color = Anno)) +
geom_line(alpha = 0.7) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(title = "Serie mensili sovrapposte per anno",
x = "Mese",
y = "Valore",
color = "Anno") +
theme_minimal()
print(plot_subseries)
ggsave(filename = "stagionalita_subseries.png", plot = plot_subseries, width = 10, height = 6)
# 3) Media mensile con banda di variabilità (media +/- sd)
monthly_summary <- df_series %>%
group_by(Mese_num) %>%
summarise(
mean_val = mean(Valore, na.rm = TRUE),
sd_val = sd(Valore, na.rm = TRUE)
) %>%
ungroup()
plot_month_mean <- ggplot(monthly_summary, aes(x = Mese_num, y = mean_val)) +
geom_line(group = 1, color = "darkgreen", size = 1) +
geom_ribbon(aes(ymin = mean_val - sd_val, ymax = mean_val + sd_val), alpha = 0.2, fill = "darkgreen") +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(title = "Media mensile e variabilità",
x = "Mese",
y = "Valore") +
theme_minimal()
print(plot_month_mean)
ggsave(filename = "stagionalita_mean.png", plot = plot_month_mean, width = 10, height = 6)
source("C:/Users/Ettore/Prog_domma_2/analisi_serie_storiche.R")
source("C:/Users/Ettore/Prog_domma_2/analisi_serie_storiche.R")
source("C:/Users/Ettore/Prog_domma_2/analisi_serie_storiche.R")
source("C:/Users/Ettore/Prog_domma_2/analisi_serie_storiche.R")
source("C:/Users/Ettore/Prog_domma_2/analisi_serie_storiche.R")
